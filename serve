#!/usr/bin/env bash

# ------------------------------------------------------------
# serve â€“ start the Deno backend for the "Don't Fall" game
# ------------------------------------------------------------
# Usage:
#   ./dontfall/serve
#
# The script runs the Deno server with the minimal
# permissions required for the current implementation:
#   * network access (listen on a port)
#   * read access to the frontend directory (static assets)
#
# If you later add persistence (e.g., write a leaderboard file)
# you can extend the permissions with `--allow-write`.
# ------------------------------------------------------------

# Resolve the directory where this script lives.
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="${SCRIPT_DIR}"

# Path to the server entry point.
SERVER_FILE="${PROJECT_ROOT}/backend/server.ts"

# Verify that the server file exists.
if [[ ! -f "${SERVER_FILE}" ]]; then
  echo "Error: ${SERVER_FILE} not found."
  exit 1
fi

# Run the Deno server.
#   --allow-net   : allow listening on a TCP port (WebSocket + HTTP)
#   --allow-read=./frontend : allow serving static files from ./frontend
deno run \
  --allow-net \
  --allow-read=./frontend \
  "${SERVER_FILE}"
